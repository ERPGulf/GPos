[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "promotion",
  "enabled": 0,
  "modified": "2025-08-24 18:28:54.079482",
  "module": "Gpos",
  "name": "promotion uom",
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\n  setup(frm) {\n    frm.set_query(\"uom\", \"items\", function (doc, cdt, cdn) {\n      const child = locals[cdt][cdn];\n      if (!child?.item_code) return {};\n\n      console.log(\"üëâ Filtering UOMs for item:\", child.item_code);\n\n      return {\n        query: \"erpnext.controllers.queries.get_item_uom_query\",\n        filters: {\n          item_code: child.item_code\n        }\n      };\n    });\n  },\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "promotion",
  "enabled": 0,
  "modified": "2025-08-21 10:33:57.535050",
  "module": "Gpos",
  "name": "priceadding in promotion",
  "script": "frappe.ui.form.on('Item child table', {\r\n    item_code: function(frm, cdt, cdn) {\r\n        frappe.msgprint(\"üÜï Item Code field triggered\");\r\n\r\n        let row = locals[cdt][cdn];\r\n        frappe.msgprint(\"üìå Selected Item Code: \" + row.item_code);\r\n\r\n        if (row.item_code) {\r\n            if (frm.doc.custom_price_list) {\r\n                frappe.msgprint(\"‚úÖ Price List exists: \" + frm.doc.custom_price_list);\r\n\r\n                frappe.call({\r\n                    method: \"frappe.client.get_list\",\r\n                    args: {\r\n                        doctype: \"Item Price\",\r\n                        filters: {\r\n                            item_code: row.item_code,\r\n                            price_list: frm.doc.custom_price_list\r\n                        },\r\n                        fields: [\"price_list_rate\"],\r\n                        limit_page_length: 1\r\n                    },\r\n                    callback: function(res) {\r\n                        frappe.msgprint(\"üì° API Call Returned for: \" + row.item_code);\r\n\r\n                        if (res.message && res.message.length > 0) {\r\n                            let price = res.message[0].price_list_rate;\r\n                            frappe.msgprint(\"‚úÖ Found Price: \" + price);\r\n                            frappe.model.set_value(cdt, cdn, \"sale_price\", price);\r\n\r\n                            // also trigger discount calculation when sale price is fetched\r\n                            calculate_discount(row, cdt, cdn);\r\n                        } else {\r\n                            frappe.msgprint(\"‚ùå No Price Found for \" + row.item_code + \" in Price List \" + frm.doc.custom_price_list);\r\n                            frappe.model.set_value(cdt, cdn, \"sale_price\", 0);\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                frappe.msgprint(\"‚ö†Ô∏è No Price List selected while choosing Item Code\");\r\n            }\r\n        } else {\r\n            frappe.msgprint(\"‚ö†Ô∏è Item Code is empty\");\r\n        }\r\n    },\r\n\r\n    discount_type: function(frm, cdt, cdn) {\r\n        let row = locals[cdt][cdn];\r\n        calculate_discount(row, cdt, cdn);\r\n    },\r\n\r\n    discount_percentage: function(frm, cdt, cdn) {\r\n        let row = locals[cdt][cdn];\r\n        calculate_discount(row, cdt, cdn);\r\n    },\r\n\r\n    discount_amount: function(frm, cdt, cdn) {\r\n        let row = locals[cdt][cdn];\r\n        calculate_discount(row, cdt, cdn);\r\n    }\r\n});\r\n\r\n\r\n// üîΩ Helper Function\r\nfunction calculate_discount(row, cdt, cdn) {\r\n    let sale_price = flt(row.sale_price) || 0;\r\n    let price_after_discount = sale_price;\r\n\r\n    if (row.discount_type === \"Discount Percentage\") {\r\n        let discount_percentage = flt(row.discount_percentage) || 0;\r\n        price_after_discount = sale_price - (sale_price * discount_percentage / 100);\r\n\r\n    } else if (row.discount_type === \"Discount Amount\" || row.discount_type === \"Rate\") {\r\n        let discount_amount = flt(row.discount__amount) || 0;\r\n        price_after_discount = sale_price - discount_amount;\r\n    }\r\n\r\n    frappe.model.set_value(cdt, cdn, \"price_after_discount\", price_after_discount);\r\n}\r\n",
  "view": "Form"
 }
]